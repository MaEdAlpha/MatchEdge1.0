
<div class="table-container">


  <table class="juicyTable" mat-table
         [dataSource]="allIndvMatches" multiTemplateDataRows
         class="mat-elevation-z8">

         <!-- Container for First tableData layer, nested -->
         <ng-container matColumnDef="{{column}}" *ngFor="let column of columnsToDisplay; let flickerColmnIndex = index">
           <!--/////TODO////// set ng-container to display just back/lay EV and Match Rating headers -->
           <th mat-header-cell *matHeaderCellDef id="column{{flickerColmnIndex}}hdr"></th>
            <td mat-cell
              class="mat-column{{flickerColmnIndex}}-data mat-cell-withdata"
              *matCellDef="let selection; let i = dataIndex"
              (click)="loadGroup(i); freezeAllMotorFunctions(); showSelectionValues(selection, i); closeIfRedirected(selection)">
              <ng-container *ngIf="selection.ignore==false">
                <ng-container *ngIf="selection.inRange">
                  <ng-container *ngIf= "( (isEvSelected && +selection['EVthisBet'] >= +prefObj.evFilterValue && +selection['EVthisBet'] < 1000) || (!isEvSelected && (+selection['MatchRating'] == +prefObj.maxRatingFilter || selection['MatchRating'] > (+prefObj.maxRatingFilter - 0.1)) ) )">
                    <ng-container *ngIf= "( +selection['BackOdds'] <= +maxOddsFilter && +selection['BackOdds'] >= +minOddsFilter )">

                      <div class="juicyCell" *ngIf="column.endsWith('BackOdds')">
                        <img  class="odds-img" src="/assets/img/betIcon.png" alt="">
                        <span  class="ticker{{(flickerColmnIndex)}}box" appFlickerData [flickerColmnIndex]="flickerColmnIndex" [isUpdated]="selection.backIsUpdated"> {{ selection[column] | number:'0.2-2'}} </span>
                      </div>

                      <div class="juicyCell" *ngIf="column.endsWith('LayOdds')">
                        <img  class="odds-img" src="/assets/img/smarketsIcon.png" alt="">
                        <span  class="ticker{{(flickerColmnIndex)}}box" appFlickerDataLay [flickerColmnIndex]="flickerColmnIndex" [isUpdated]="selection.layIsUpdated"> {{ selection[column] | number:'0.2-2' }} </span>
                      </div>


                      <div class="juicyCell" *ngIf="column.endsWith('Bet')">
                        <span class="ev{{flickerColmnIndex}}box juicyCell" appFlickerDataEv [isUpdated]="selection.evIsUpdated">   Â£{{selection[column] | number: '0.2-2'}} </span>
                      </div>

                      <!-- use directive for displaying matchRating values -->
                      <div class="juicyCell" *ngIf="column.endsWith('Rating')">
                        <span class="mr{{flickerColmnIndex}}box" appFlickerDataMatchRating [isUpdated]="selection.matchRatingUpdated"> {{selection[column] | number: '0.2-2'}}% </span>
                      </div>
                      <div class="juicyCell FTAround" *ngIf="column.endsWith('Around')">
                        <span> {{selection[column] | number: '0.2-2'}} </span>
                      </div>

                      <span *ngIf="!column.endsWith('Odds') && !column.endsWith('Bet') && !column.endsWith('Rating') && !column.endsWith('Around')"> {{ selection[column] }}</span>
                    </ng-container>
                  </ng-container>
                </ng-container>
              </ng-container>
            </td>
         </ng-container>

         <!-- @detailExpand is a directive that uses expandedDetail in matColumnDef to create the expanded container -->
         <ng-container matColumnDef="expandedDetail">
           <td mat-cell *matCellDef="let selection; let i=dataIndex" [attr.colspan]="columnsToDisplay.length" >
             <!-- <ng-container>            </ng-container> -->
             <div class="juicyMatch-detail"
             [@detailExpand]="selection == expandedElement || selection.isRedirected == 'Yes' ? 'expanded' : 'collapsed'">
             <ng-container *ngIf="expandedElement === selection || selection.isRedirected =='Yes'">
               <form [formGroup]="selectionValues">

               <div class="jm-exp-details-row1"> <!--Main container for juicy match-->
                 <div class="row1 row1-first">  <!--Team name and Logo-->
                   <div class="jed-cell1" id="selection"><h1>{{selection.Selection}}</h1><!--Contains logo and prev odds. -->
                          <div class="jed-cell1" id="logo"><img src="/assets/img/fcLogo/{{selection.Logo}}.png"> </div>
                          <!-- <div class="jed-cell" id="prev-odds"><p> <b> {{i}} PREV. BACK ODDS</b></p><h3> {{selection.b365HPrev[selection.b365HPrev.length - 1].odds | number:'0.2-2'}} | H - A | {{selection.b365APrev[selection.b365APrev.length - 1].odds | number:'0.2-2'}}</h3></div> -->
                    </div>
                  </div>

                        <div class="jm-exp-details-col2-cont"> <!--Container for betting instructions and info-->
                          <div class="jm-exp-details-col2row1 shadow"> <!--Outer container for back bet instructions-->
                            <div class="user-directions"> <!--inner container for back bet elements-->
                              <div class="bookie-words-container"> <!--Container for each group within the row-->
                                <p class = "bookie-goto-style">GO TO</p> <img class="bookie-img" src="/assets/img/bet365II.png">
                              </div>
                              <div class="bookie-words-container">
                                <p class="bookie-bet-style">BET</p> <input formControlName="Stake" class = "value-box-back" placeholder="{{getGroup(i).get('Stake').value}}">
                              </div>
                              <div class="bookie-words-container">
                                <p class= "bookie-atodds-style">AT ODDS </p><input formControlName="BackOdds" class = "value-box-back"  placeholder="{{getGroup(i).get('BackOdds').value | number:'0.2-2'}}">
                              </div>
                              <div class="bookie-words-container">
                                <p class= "bookie-for-style">FOR </p> <p><div class="bookie-teamname-style">{{selection.Selection}}</div>
                              </div>
                              <div class="bookie-button-container" id="bet365lnk"><a class="mat-raised-button-bookie-exchange" mat-raised-button href= {{selection.UrlB365}} >OPEN EVENT</a></div>
                              </div>

                          </div>

                          <div class="jm-exp-details-col2row2 shadow">
                            <div class="user-directions">
                              <div class="exchange-words-container">
                                <p class="exchange-bet-style">GO TO </p> <img class="exchange-img" src="/assets/img/smarketsII.png">
                              </div>

                              <div class="exchange-words-container">
                                <p class="exchange-lay-style">LAY </p>
                                    <!-- <input formControlName="LayStake" class = "value-box-lay"  placeholder="{{selection.LayStake | currency:'GBP'}}"> -->
                                    <input class="value-box-lay"   [readOnly]="true" placeholder="{{LayStake(getGroup(i).get('BackOdds').value, getGroup(i).get('LayOdds').value, getGroup(i).get('Stake').value) | currency:'GBP' }}">
                                  </div>

                                  <div class="exchange-words-container">
                                      <!-- Ever going to need to manually change this value? -->
                                      <p class="exchange-atodds-style">AT ODDS </p> <input formControlName="LayOdds" class = "value-box-lay"  placeholder="{{selection.LayOdds | number:'0.2-2'}}">
                                    </div>

                                    <div class="exchange-words-container">
                                      <p class="exchange-liability-style" id="liability">YOUR LIABILITY:</p> <p><div class="exchange-layamount-style">{{ Liability(getGroup(i).get('LayOdds').value, LayStake(getGroup(i).get('BackOdds').value, getGroup(i).get('LayOdds').value, getGroup(i).get('Stake').value)) | currency:'GBP'}}</div>
                                    </div>

                                    <div class="exchange-button-container" id="smlnk"><a class="mat-raised-button-bookie-exchange" mat-raised-button href= {{selection.UrlSmarkets}} target="_blank">OPEN EVENT</a></div>
                                  </div>

                                </div>


                                <div class="jm-exp-details-col2row3">

                                  <div class="selection-figures row4-row1">
                                    <div class="r1 r1-col1">
                                      <h3 class="selection-figures-content1">ROI:</h3>
                                <span class="selection-figures-content1">{{ ROI(getGroup(i).get('Stake').value, getGroup(i).get('BackOdds').value, getGroup(i).get('LayOdds').value, selection.FTAround) | number:'0.2-2'}} %</span>
                              </div>
                              <div class="r1 r1-col2">
                                <h3 class="selection-figures-content2">Full Turnaround: </h3>
                                <span class="selection-figures-content2"> {{ FTA( getGroup(i).get('Stake').value, getGroup(i).get('BackOdds').value, getGroup(i).get('LayOdds').value  ) | currency:'GBP'}}</span></div>
                              </div>

                              <div class="rcd-btn">
                                <button mat-raised-button class="exp-button">Record Bet</button>
                                <p class="betState">Lay bet is</p>
                                <button mat-raised-button class="bet-state-button" [style.background]="selection.activeBetState ? 'green' : 'red'" (click)="selection.activeBetState = !selection.activeBetState">{{ selection.activeBetState ? 'Matched' : 'Unmatched'}}</button>
                                <!-- button match / unmatched  -->
                              </div>

                              <div class="selection-figures row4-row2">
                                <div class="r2 r2-col1">
                                  <h3 class="selection-figures-content1">Total EV: </h3>
                                  <span class="selection-figures-content2">{{ TotalEV( selection.FTAround,  getGroup(i).get('Stake').value, getGroup(i).get('BackOdds').value, getGroup(i).get('LayOdds').value, getGroup(i).get('Stake').value)  | currency:'GBP' }}</span>
                                </div>

                                <div class="r2 r2-col2">
                                  <h3 class="selection-figures-content2">Qualifying Loss: </h3>
                                  <span class="selection-figures-content2"> {{QL( getGroup(i).get('BackOdds').value, getGroup(i).get('LayOdds').value, getGroup(i).get('Stake').value) | currency:'GBP'}}  </span>
                                </div>
                              </div>


                            </div>
                          </div>

                        </div>
               </form>
             </ng-container>


             </div>
            </td>
          </ng-container>

              <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
              <!-- When you click this row, it changes  the .juicyMatch-row class to .juicyMatch-expanded-row -->
              <!-- (click) function says: if the expanded Element is this selection object, make it null -->
              <!-- read ignore status in here -->
              <tr mat-row *matRowDef="let selection; columns: columnsToDisplay;"
              class="juicyMatch-row"
              [ngClass]="selection.isRedirected == 'Yes' ? 'juicyMatch-expanded-row': null"
              [class.juicyMatch-expanded-row]="expandedElement === selection"
              (click)="expandedElement = expandedElement === selection ? null : selection"
              appHideTableRow [userPref]="prefObj" [backOdds]="selection.BackOdds" [evValue]="selection.EVthisBet" [mrValue]="selection.MatchRating" [ignore]="selection.ignore" [inRange]="selection.inRange">
              </tr>

              <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="juicyMatch-detail-row"></tr>

  </table>

  <div class="no-content" *ngIf="noMatchesToDisplay">Currently No Matches Detected</div>
</div>


